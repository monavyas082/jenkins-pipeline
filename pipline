pipeline{
    agent any
    stages{
        stage("code"){
            steps{
                echo "pull the code"
                git url: "https://github.com/LondheShubham153/django-notes-app.git" , branch: "main"
            }

        }
        stage("build"){
            steps{
                echo "build the code"
                sh "docker build -t my-note-app ."
            }

        }
        stage("push the image"){
            steps{
                echo "push image to dockerhub"
                 withCredentials([usernamePassword(credentialsId:"dockerhub",passwordVariable:"dockerhubPass",usernameVariable:"dockerhubUser")]){
                sh "docker tag my-note-app ${env.dockerhubUser}/my-note-app:latest"
                sh "docker login -u ${env.dockerhubUser} -p ${env.dockerhubPass}"
                sh "docker push ${env.dockerhubUser}/my-note-app:latest"
                 }

            }
        }
        stage("deploy"){
            steps{
                echo "deploy the container"
                sh "docker run -d -p 8000:8000 monikavyas1/my-note-app:latest"
            }

        }
        

    }
}